# OPSè¿ç»´ç®¡ç†ç³»ç»Ÿ - å®Œæ•´ç”¨æˆ·æ‰‹å†Œ

## ğŸ“‹ ç›®å½•

- [ç³»ç»Ÿæ¦‚è¿°](#ç³»ç»Ÿæ¦‚è¿°)
- [æ ¸å¿ƒåŠŸèƒ½](#æ ¸å¿ƒåŠŸèƒ½)
- [ç³»ç»Ÿæ¶æ„](#ç³»ç»Ÿæ¶æ„)
- [å®‰è£…éƒ¨ç½²](#å®‰è£…éƒ¨ç½²)
- [é…ç½®è¯´æ˜](#é…ç½®è¯´æ˜)
- [Webç•Œé¢ä½¿ç”¨æŒ‡å—](#Webç•Œé¢ä½¿ç”¨æŒ‡å—)
- [TCPè®¤è¯ç³»ç»Ÿ](#TCPè®¤è¯ç³»ç»Ÿ)
- [APIæ¥å£è¯´æ˜](#APIæ¥å£è¯´æ˜)
- [å®‰å…¨ç‰¹æ€§](#å®‰å…¨ç‰¹æ€§)
- [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)

---

## ç³»ç»Ÿæ¦‚è¿°

OPSè¿ç»´ç®¡ç†ç³»ç»Ÿæ˜¯ä¸€ä¸ªåŸºäºRustçš„åˆ†å¸ƒå¼è¿ç»´ç›‘æ§å¹³å°ï¼Œé‡‡ç”¨å®¢æˆ·ç«¯-æœåŠ¡ç«¯æ¶æ„è®¾è®¡ã€‚ç³»ç»Ÿæä¾›å®æ—¶ç³»ç»Ÿç›‘æ§ã€è¿œç¨‹å‘½ä»¤æ‰§è¡Œã€åº”ç”¨ç‰ˆæœ¬ç®¡ç†ã€Webç®¡ç†ç•Œé¢ç­‰ä¼ä¸šçº§è¿ç»´åŠŸèƒ½ã€‚

### ä¸»è¦ç‰¹ç‚¹

- ğŸ” **ä¼ä¸šçº§å®‰å…¨**ï¼šæ”¯æŒWebä¼šè¯è®¤è¯ã€TCPåŒå‘è®¤è¯ã€å‘½ä»¤ç™½åå•éªŒè¯
- ğŸŒ **ç°ä»£åŒ–ç•Œé¢**ï¼šå“åº”å¼Web UIï¼Œæ”¯æŒç§»åŠ¨ç«¯è®¿é—®
- âš¡ **é«˜æ€§èƒ½æ¶æ„**ï¼šå¼‚æ­¥å¤„ç†ï¼Œæ”¯æŒå¤§é‡å¹¶å‘è¿æ¥
- ğŸ›¡ï¸ **å®‰å…¨å¯é **ï¼šå¤šå±‚å®‰å…¨é˜²æŠ¤ï¼Œé˜²æ­¢æ¶æ„å‘½ä»¤æ‰§è¡Œ
- ğŸ“± **æ™ºèƒ½ç®¡ç†**ï¼šè‡ªåŠ¨åº”ç”¨å‘ç°ã€ç‰ˆæœ¬è·Ÿè¸ªã€æœåŠ¡çŠ¶æ€ç›‘æ§
- ğŸ”„ **å®æ—¶ç›‘æ§**ï¼šå¿ƒè·³æ£€æµ‹ã€è¿æ¥çŠ¶æ€å®æ—¶æ›´æ–°

---

## æ ¸å¿ƒåŠŸèƒ½

### 1. ç³»ç»Ÿç›‘æ§
- **å®æ—¶çŠ¶æ€ç›‘æ§**ï¼šCPUã€å†…å­˜ã€ç£ç›˜ä½¿ç”¨æƒ…å†µ
- **ç½‘ç»œä¿¡æ¯æ”¶é›†**ï¼šIPåœ°å€ã€ç½‘ç»œè¿æ¥çŠ¶æ€
- **å®¢æˆ·ç«¯å¥åº·æ£€æŸ¥**ï¼šå¿ƒè·³ç›‘æµ‹ã€è¿æ¥çŠ¶æ€ç®¡ç†
- **ç³»ç»Ÿä¿¡æ¯å±•ç¤º**ï¼šä¸»æœºåã€æ“ä½œç³»ç»Ÿã€ç¡¬ä»¶ä¿¡æ¯

### 2. è¿œç¨‹å‘½ä»¤æ‰§è¡Œ
- **å®‰å…¨å‘½ä»¤æ‰§è¡Œ**ï¼šåŸºäºç™½åå•çš„å‘½ä»¤éªŒè¯
- **å®æ—¶ç»“æœåé¦ˆ**ï¼šå‘½ä»¤æ‰§è¡ŒçŠ¶æ€å’Œè¾“å‡ºå®æ—¶æ˜¾ç¤º
- **å‘½ä»¤å†å²è®°å½•**ï¼šæ‰§è¡Œå†å²è·Ÿè¸ªå’Œé‡å¤æ‰§è¡Œ
- **é¢„å®šä¹‰å‘½ä»¤**ï¼šå¸¸ç”¨è¿ç»´å‘½ä»¤å¿«é€Ÿæ‰§è¡Œ

### 3. åº”ç”¨ç‰ˆæœ¬ç®¡ç†
- **è‡ªåŠ¨åº”ç”¨å‘ç°**ï¼šæ‰«ææŒ‡å®šç›®å½•çš„åº”ç”¨éƒ¨ç½²ä¿¡æ¯
- **ç‰ˆæœ¬ä¿¡æ¯æ”¶é›†**ï¼šGitåˆ†æ”¯ã€æäº¤å“ˆå¸Œã€éƒ¨ç½²æ—¶é—´
- **æœåŠ¡çŠ¶æ€ç›‘æ§**ï¼šåº”ç”¨æœåŠ¡è¿è¡ŒçŠ¶æ€æ£€æŸ¥
- **è¿œç¨‹åº”ç”¨ç®¡ç†**ï¼šå¯åŠ¨ã€åœæ­¢ã€é‡å¯ã€æ›´æ–°åº”ç”¨

### 4. Webç®¡ç†ç•Œé¢
- **ç”¨æˆ·è®¤è¯ç³»ç»Ÿ**ï¼šå®‰å…¨çš„ä¼šè¯ç®¡ç†ï¼Œ1å°æ—¶è‡ªåŠ¨è¶…æ—¶
- **æ´»åŠ¨ç›‘æ§æœºåˆ¶**ï¼šç”¨æˆ·æ´»åŠ¨è‡ªåŠ¨å»¶é•¿ä¼šè¯
- **å“åº”å¼è®¾è®¡**ï¼šæ”¯æŒæ¡Œé¢å’Œç§»åŠ¨è®¾å¤‡
- **å¤šæ ‡ç­¾ç®¡ç†**ï¼šç³»ç»Ÿä¿¡æ¯ã€åº”ç”¨ç®¡ç†ã€å‘½ä»¤æ‰§è¡Œ

### 5. TCPè®¤è¯æœºåˆ¶
- **HMAC-SHA256è®¤è¯**ï¼šåŸºäºå…±äº«å¯†é’¥çš„æŒ‘æˆ˜-å“åº”åè®®
- **é˜²é‡æ”¾æ”»å‡»**ï¼šæ—¶é—´æˆ³éªŒè¯å’Œéšæœºæ•°ä¿æŠ¤
- **å‘åå…¼å®¹**ï¼šå¯é€‰å¯ç”¨ï¼Œä¸å½±å“ç°æœ‰éƒ¨ç½²

---

## ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Web Browser   â”‚    â”‚   ops-client    â”‚    â”‚   ops-client    â”‚
â”‚                 â”‚    â”‚    (Node 1)     â”‚    â”‚    (Node 2)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                      â”‚                      â”‚
          â”‚ HTTP/HTTPS           â”‚ TCP                  â”‚ TCP
          â”‚ Port 3000            â”‚ Port 12345          â”‚ Port 12345
          â”‚                      â”‚                      â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚     ops-server          â”‚
                    â”‚                         â”‚
                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                    â”‚  â”‚   Web API       â”‚   â”‚
                    â”‚  â”‚   - Auth        â”‚   â”‚
                    â”‚  â”‚   - Management  â”‚   â”‚
                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                    â”‚                         â”‚
                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                    â”‚  â”‚   TCP Service   â”‚   â”‚
                    â”‚  â”‚   - Client Mgmt â”‚   â”‚
                    â”‚  â”‚   - Command Exe â”‚   â”‚
                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€æœ¯æ ˆ

- **åç«¯**ï¼šRust + Tokio + Axum
- **å‰ç«¯**ï¼šåŸç”ŸHTML/CSS/JavaScript
- **è®¤è¯**ï¼šSession-based + HMAC-SHA256
- **é€šä¿¡**ï¼šTCP (å®¢æˆ·ç«¯) + HTTP (Webç•Œé¢)
- **åºåˆ—åŒ–**ï¼šJSON + Serde
- **æ—¥å¿—**ï¼šTracing + æ–‡ä»¶è½®è½¬

---

## å®‰è£…éƒ¨ç½²

### æ–¹å¼ä¸€ï¼šDocker Compose éƒ¨ç½²ï¼ˆæ¨èï¼‰

1. **å…‹éš†é¡¹ç›®**
```bash
git clone <repository-url>
cd ops-system
```

2. **å¯åŠ¨æœåŠ¡**
```bash
# å¯åŠ¨å®Œæ•´æœåŠ¡ï¼ˆ1ä¸ªæœåŠ¡ç«¯ + 2ä¸ªå®¢æˆ·ç«¯ï¼‰
docker-compose up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f ops-server
```

3. **è®¿é—®ç³»ç»Ÿ**
```bash
# æ‰“å¼€Webç•Œé¢
open http://localhost:3000
```

### æ–¹å¼äºŒï¼šæºç ç¼–è¯‘éƒ¨ç½²

1. **å®‰è£…Rustç¯å¢ƒ**
```bash
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
source ~/.cargo/env
```

2. **ç¼–è¯‘é¡¹ç›®**
```bash
git clone <repository-url>
cd ops-system

# è¿è¡Œæµ‹è¯•
cargo test

# ç¼–è¯‘å‘å¸ƒç‰ˆæœ¬
cargo build --release
```

3. **éƒ¨ç½²æœåŠ¡ç«¯**
```bash
# å¤åˆ¶é…ç½®æ–‡ä»¶
cp config.example.toml config.toml

# ç¼–è¾‘é…ç½®
vim config.toml

# å¯åŠ¨æœåŠ¡ç«¯
cargo run --release --bin ops-server
```

4. **éƒ¨ç½²å®¢æˆ·ç«¯**
```bash
# åœ¨éœ€è¦ç›‘æ§çš„æœåŠ¡å™¨ä¸Š
export OPS_SERVER_HOST=your-server-ip
export OPS_SERVER_PORT=12345
cargo run --release --bin ops-client
```

---

## é…ç½®è¯´æ˜

### æœåŠ¡ç«¯é…ç½®

#### ç¯å¢ƒå˜é‡é…ç½®
```bash
# ç½‘ç»œé…ç½®
export OPS_TCP_BIND_ADDR=0.0.0.0      # TCPæœåŠ¡ç»‘å®šåœ°å€
export OPS_HTTP_BIND_ADDR=0.0.0.0     # HTTPæœåŠ¡ç»‘å®šåœ°å€
export OPS_TCP_PORT=12345              # TCPæœåŠ¡ç«¯å£
export OPS_HTTP_PORT=3000              # HTTPæœåŠ¡ç«¯å£

# ç®¡ç†é…ç½®
export OPS_CLEANUP_INTERVAL=60         # æ¸…ç†è¿‡æœŸå®¢æˆ·ç«¯é—´éš”(ç§’)
export OPS_CLIENT_TIMEOUT=300          # å®¢æˆ·ç«¯è¶…æ—¶æ—¶é—´(ç§’)
export OPS_MAX_CONNECTIONS=1000        # æœ€å¤§è¿æ¥æ•°

# å®‰å…¨é…ç½®
export OPS_AUTH_TOKEN=your-token-here  # APIè®¤è¯ä»¤ç‰Œ(å¯é€‰)

# TCPè®¤è¯é…ç½®
export OPS_TCP_AUTH_ENABLED=true       # å¯ç”¨TCPè®¤è¯
export OPS_TCP_AUTH_SECRET=your-secret # TCPè®¤è¯å…±äº«å¯†é’¥
```

#### TOMLé…ç½®æ–‡ä»¶ç¤ºä¾‹
```toml
[server]
tcp_bind_addr = "0.0.0.0"
http_bind_addr = "0.0.0.0"
tcp_port = 12345
http_port = 3000
cleanup_interval_secs = 60
client_timeout_secs = 300
max_connections = 1000
auth_token = "your-secure-token"

# è„šæœ¬æ‰§è¡Œå®‰å…¨é…ç½®
allowed_script_dirs = [
    "/opt/ops-scripts",
    "/usr/local/bin/scripts",
    "/home/ops/scripts"
]
allowed_script_extensions = ["sh", "py", "pl", "rb"]
```

### å®¢æˆ·ç«¯é…ç½®

#### ç¯å¢ƒå˜é‡é…ç½®
```bash
# è¿æ¥é…ç½®
export OPS_SERVER_HOST=127.0.0.1       # æœåŠ¡ç«¯åœ°å€
export OPS_SERVER_PORT=12345            # æœåŠ¡ç«¯TCPç«¯å£
export OPS_HEARTBEAT_INTERVAL=3         # å¿ƒè·³é—´éš”(ç§’)

# é‡è¿é…ç½®
export OPS_RETRY_MAX_ATTEMPTS=10        # æœ€å¤§é‡è¯•æ¬¡æ•°
export OPS_RETRY_BASE_DELAY=2           # åŸºç¡€é‡è¯•å»¶è¿Ÿ(ç§’)
export OPS_RETRY_MAX_DELAY=60           # æœ€å¤§é‡è¯•å»¶è¿Ÿ(ç§’)

# æ–‡ä»¶é…ç½®
export OPS_CLIENT_ID_FILE=/tmp/client_id.txt      # å®¢æˆ·ç«¯IDæ–‡ä»¶
export OPS_APPS_BASE_DIR=/tmp/apps                # åº”ç”¨æ‰«æç›®å½•
export OPS_COMMAND_LOG_FILE=/tmp/client_commands.log  # å‘½ä»¤æ—¥å¿—

# è®¤è¯é…ç½®
export OPS_AUTH_TOKEN=your-token-here   # HTTPè®¤è¯ä»¤ç‰Œ
export OPS_TCP_AUTH_ENABLED=true        # å¯ç”¨TCPè®¤è¯
export OPS_TCP_AUTH_SECRET=your-secret  # TCPè®¤è¯å…±äº«å¯†é’¥
```

#### å‘½ä»¤è¡Œå‚æ•°
```bash
# åŸºæœ¬è¿æ¥é…ç½®
cargo run --bin ops-client -- --host 192.168.1.100 --port 12345

# ä½¿ç”¨é…ç½®æ–‡ä»¶
cargo run --bin ops-client -- --config client-config.toml

# ç»„åˆé…ç½®ï¼ˆå‘½ä»¤è¡Œå‚æ•°ä¼˜å…ˆçº§æœ€é«˜ï¼‰
cargo run --bin ops-client -- --config client-config.toml --host 10.0.0.50
```

---

## Webç•Œé¢ä½¿ç”¨æŒ‡å—

### ç™»å½•ç³»ç»Ÿ

1. **è®¿é—®ç™»å½•é¡µé¢**
   - æ‰“å¼€æµè§ˆå™¨è®¿é—® `http://your-server:3000`
   - ç³»ç»Ÿé»˜è®¤ç”¨æˆ·åï¼š`admin`
   - ç³»ç»Ÿé»˜è®¤å¯†ç ï¼š`admin123`

2. **ä¼šè¯ç®¡ç†ç‰¹æ€§**
   - ç™»å½•åä¼šè¯æœ‰æ•ˆæœŸï¼š**1å°æ—¶**
   - ç”¨æˆ·æ´»åŠ¨æ—¶è‡ªåŠ¨å»¶é•¿ä¼šè¯
   - 5åˆ†é’Ÿæ— æ´»åŠ¨æ˜¾ç¤ºè¶…æ—¶è­¦å‘Š
   - 1å°æ—¶æ— æ´»åŠ¨è‡ªåŠ¨ç™»å‡º
   - é¡µé¢åˆ·æ–°æ— éœ€é‡æ–°ç™»å½•

### ç³»ç»Ÿä¿¡æ¯é¡µé¢

#### ç³»ç»ŸçŠ¶æ€æ¦‚è§ˆ
- **åœ¨çº¿å®¢æˆ·ç«¯æ•°é‡**ï¼šæ˜¾ç¤ºå½“å‰è¿æ¥çš„å®¢æˆ·ç«¯æ€»æ•°
- **æœ€åæ›´æ–°æ—¶é—´**ï¼šæ•°æ®æœ€ååˆ·æ–°æ—¶é—´
- **æœåŠ¡å™¨è¿è¡ŒçŠ¶æ€**ï¼šæœåŠ¡å™¨å¥åº·çŠ¶æ€æŒ‡ç¤º

#### å®¢æˆ·ç«¯åˆ—è¡¨
æ¯ä¸ªå®¢æˆ·ç«¯å¡ç‰‡æ˜¾ç¤ºï¼š
- **ä¸»æœºå**å’Œ**è¿æ¥çŠ¶æ€**ï¼ˆåœ¨çº¿/ç¦»çº¿ï¼‰
- **å®¢æˆ·ç«¯ID**ï¼ˆæ˜¾ç¤ºå‰8ä½ï¼‰
- **CPUå‹å·**å’Œ**å†…å­˜ä½¿ç”¨æƒ…å†µ**
- **IPåœ°å€**åˆ—è¡¨
- **æœ€åå¿ƒè·³æ—¶é—´**å’Œè¿æ¥çŠ¶æ€

#### åº”ç”¨éƒ¨ç½²ä¿¡æ¯
- **åº”ç”¨åç§°**å’Œ**ç‰ˆæœ¬å·**
- **éƒ¨ç½²æ—¶é—´**å’Œ**Gitä¿¡æ¯**
- **æœåŠ¡è¿è¡ŒçŠ¶æ€**
- æ”¯æŒæŒ‰å®¢æˆ·ç«¯åˆ†ç»„æ˜¾ç¤º

### åº”ç”¨ç®¡ç†é¡µé¢

#### ç­›é€‰åŠŸèƒ½
- **å®¢æˆ·ç«¯ç­›é€‰**ï¼šæŒ‰ç‰¹å®šå®¢æˆ·ç«¯ç­›é€‰
- **åº”ç”¨åç§°ç­›é€‰**ï¼šæ¨¡ç³Šæœç´¢åº”ç”¨åç§°
- **è¿æ¥çŠ¶æ€ç­›é€‰**ï¼šåœ¨çº¿/ç¦»çº¿å®¢æˆ·ç«¯
- **æœåŠ¡çŠ¶æ€ç­›é€‰**ï¼šè¿è¡Œä¸­/å·²åœæ­¢/æœªçŸ¥çŠ¶æ€

#### åº”ç”¨æ“ä½œ
- **æ›´æ–°åº”ç”¨**ï¼šæŒ‡å®šæ–°ç‰ˆæœ¬è¿›è¡Œåº”ç”¨æ›´æ–°
- **å¯åŠ¨æœåŠ¡**ï¼šå¯åŠ¨å·²åœæ­¢çš„åº”ç”¨æœåŠ¡
- **åœæ­¢æœåŠ¡**ï¼šåœæ­¢è¿è¡Œä¸­çš„åº”ç”¨æœåŠ¡
- **æœåŠ¡çŠ¶æ€æŸ¥çœ‹**ï¼šå®æ—¶æŸ¥çœ‹æœåŠ¡è¿è¡ŒçŠ¶æ€

### å‘½ä»¤æ‰§è¡Œé¡µé¢

#### å‘½ä»¤ç±»å‹
1. **é¢„å®šä¹‰å‘½ä»¤**ï¼š
   - ç³»ç»Ÿä¿¡æ¯ç±»ï¼š`ps aux`, `whoami`, `date`, `uptime`
   - èµ„æºç›‘æ§ç±»ï¼š`free -h`, `df -h`, `top -n 1`
   - ç½‘ç»œä¿¡æ¯ç±»ï¼š`netstat -tlnp`
   - æ–‡ä»¶ç³»ç»Ÿç±»ï¼š`ls -la`
   - æœåŠ¡ç®¡ç†ç±»ï¼š`systemctl status`

2. **è‡ªå®šä¹‰å‘½ä»¤**ï¼š
   - æ”¯æŒè‡ªå®šä¹‰è¾“å…¥å‘½ä»¤
   - è‡ªåŠ¨è¿›è¡Œå®‰å…¨éªŒè¯
   - å±é™©å‘½ä»¤ä¼šè¢«æ‹’ç»æ‰§è¡Œ

#### å‘½ä»¤æ‰§è¡Œæµç¨‹
1. é€‰æ‹©ç›®æ ‡å®¢æˆ·ç«¯
2. é€‰æ‹©å‘½ä»¤ç±»å‹ï¼ˆé¢„å®šä¹‰/è‡ªå®šä¹‰ï¼‰
3. é€‰æ‹©æˆ–è¾“å…¥å…·ä½“å‘½ä»¤
4. ç‚¹å‡»"æ‰§è¡Œå‘½ä»¤"æŒ‰é’®
5. å®æ—¶æŸ¥çœ‹æ‰§è¡Œç»“æœ

#### æ‰§è¡Œç»“æœæ˜¾ç¤º
- **å‘½ä»¤å†…å®¹**å’Œ**æ‰§è¡Œæ—¶é—´**
- **é€€å‡ºç **ï¼š0è¡¨ç¤ºæˆåŠŸï¼Œé0è¡¨ç¤ºå¤±è´¥
- **æ ‡å‡†è¾“å‡º**ï¼šå‘½ä»¤çš„æ­£å¸¸è¾“å‡º
- **é”™è¯¯è¾“å‡º**ï¼šå‘½ä»¤çš„é”™è¯¯ä¿¡æ¯
- **æ‰§è¡ŒçŠ¶æ€**ï¼šæ­£åœ¨æ‰§è¡Œ/å·²å®Œæˆ/è¶…æ—¶/å¤±è´¥

#### å‘½ä»¤å†å²
- æ˜¾ç¤ºæœ€è¿‘10æ¡æ‰§è¡Œå†å²
- æ”¯æŒé‡å¤æ‰§è¡Œå†å²å‘½ä»¤
- è®°å½•æ‰§è¡Œæ—¶é—´å’Œç›®æ ‡å®¢æˆ·ç«¯

---

## TCPè®¤è¯ç³»ç»Ÿ

### è®¤è¯æœºåˆ¶åŸç†

ç³»ç»Ÿé‡‡ç”¨åŸºäºHMAC-SHA256çš„æŒ‘æˆ˜-å“åº”è®¤è¯åè®®ï¼š

```
1. å®¢æˆ·ç«¯è¿æ¥æœåŠ¡å™¨
2. æœåŠ¡å™¨ç”Ÿæˆéšæœºè´¨è¯¢ (nonce + timestamp)
3. å®¢æˆ·ç«¯è®¡ç®—å“åº”: HMAC-SHA256(shared_secret, client_id + nonce + timestamp)
4. æœåŠ¡å™¨éªŒè¯å“åº”
5. è®¤è¯æˆåŠŸï¼šæ­£å¸¸é€šä¿¡ | è®¤è¯å¤±è´¥ï¼šæ–­å¼€è¿æ¥
```

### é…ç½®TCPè®¤è¯

#### æœåŠ¡ç«¯é…ç½®
```bash
export OPS_TCP_AUTH_ENABLED=true          # å¯ç”¨TCPè®¤è¯
export OPS_TCP_AUTH_SECRET=your-secret    # å…±äº«å¯†é’¥
export OPS_TCP_PORT=12346                 # TCPç«¯å£
export OPS_HTTP_PORT=3003                 # HTTPç«¯å£
```

#### å®¢æˆ·ç«¯é…ç½®
```bash
export OPS_TCP_AUTH_ENABLED=true          # å¯ç”¨TCPè®¤è¯  
export OPS_TCP_AUTH_SECRET=your-secret    # å…±äº«å¯†é’¥(ä¸æœåŠ¡å™¨ç›¸åŒ)
export OPS_SERVER_PORT=12346              # æœåŠ¡å™¨TCPç«¯å£
```

### å®‰å…¨ç‰¹æ€§

1. **é˜²é‡æ”¾æ”»å‡»**
   - æ—¶é—´æˆ³éªŒè¯ï¼Œè´¨è¯¢30ç§’è¿‡æœŸ
   - å“åº”60ç§’å†…æœ‰æ•ˆ
   - æ¯æ¬¡è¿æ¥ç”Ÿæˆæ–°çš„éšæœºæ•°

2. **é˜²æ—¶åºæ”»å‡»**
   - ä½¿ç”¨æ’å®šæ—¶é—´å­—ç¬¦ä¸²æ¯”è¾ƒ
   - é˜²æ­¢é€šè¿‡å“åº”æ—¶é—´æ¨æµ‹å¯†é’¥

3. **å¯†é’¥ç®¡ç†**
   - é€šè¿‡ç¯å¢ƒå˜é‡é…ç½®å…±äº«å¯†é’¥
   - æ”¯æŒå¯†é’¥è½®æ¢
   - å¯†é’¥ä¸åœ¨ä»£ç ä¸­ç¡¬ç¼–ç 

### æµ‹è¯•TCPè®¤è¯

```bash
# æœåŠ¡å™¨ç«¯ - æ­£ç¡®å¯†é’¥
OPS_TCP_AUTH_ENABLED=true OPS_TCP_AUTH_SECRET=test-secret-123 OPS_TCP_PORT=12346 cargo run --bin ops-server

# å®¢æˆ·ç«¯ - æ­£ç¡®å¯†é’¥ï¼ˆåº”è¯¥è¿æ¥æˆåŠŸï¼‰
OPS_TCP_AUTH_ENABLED=true OPS_TCP_AUTH_SECRET=test-secret-123 OPS_SERVER_PORT=12346 cargo run --bin ops-client

# å®¢æˆ·ç«¯ - é”™è¯¯å¯†é’¥ï¼ˆåº”è¯¥è¢«æ‹’ç»ï¼‰
OPS_TCP_AUTH_ENABLED=true OPS_TCP_AUTH_SECRET=wrong-secret-456 OPS_SERVER_PORT=12346 cargo run --bin ops-client
```

---

## APIæ¥å£è¯´æ˜

### è®¤è¯ç›¸å…³API

#### ç™»å½•
```bash
POST /api/login
Content-Type: application/json

{
  "username": "admin",
  "password": "admin123"
}

# å“åº”
{
  "success": true,
  "message": "ç™»å½•æˆåŠŸ",
  "session_id": "uuid-string"
}
```

#### æ£€æŸ¥è®¤è¯çŠ¶æ€
```bash
GET /api/check-auth
Cookie: session_id=your-session-id

# å“åº”
{
  "success": true,
  "message": "å·²è®¤è¯",
  "session_id": "uuid-string"
}
```

#### ç™»å‡º
```bash
POST /api/logout
Cookie: session_id=your-session-id

# å“åº”
{
  "success": true,
  "message": "ç™»å‡ºæˆåŠŸ",
  "session_id": null
}
```

### ç³»ç»Ÿç®¡ç†API

#### è·å–å®¢æˆ·ç«¯åˆ—è¡¨
```bash
GET /api/clients
Cookie: session_id=your-session-id

# å“åº”
{
  "clients": {
    "client-uuid": {
      "system_info": {
        "hostname": "server01",
        "cpu_model": "Intel Core i7",
        "total_memory": 16777216000,
        "used_memory": 8388608000,
        "ip_addresses": ["192.168.1.100"]
      },
      "app_info": [...],
      "last_seen": {...}
    }
  }
}
```

#### å‘é€å‘½ä»¤åˆ°å®¢æˆ·ç«¯
```bash
POST /api/send-command
Content-Type: application/json
Cookie: session_id=your-session-id

{
  "client_id": "client-uuid",
  "command": "ps aux"
}

# å“åº”
{
  "command_id": "command-uuid",
  "message": "å‘½ä»¤å·²å‘é€åˆ°å®¢æˆ·ç«¯"
}
```

#### è·å–å‘½ä»¤æ‰§è¡Œç»“æœ
```bash
GET /api/command-result?command_id=command-uuid
Cookie: session_id=your-session-id

# å“åº”
{
  "Completed": {
    "command": "ps aux",
    "exit_code": 0,
    "output": "command output...",
    "error_output": "",
    "executed_at": {...}
  }
}
```

### åº”ç”¨ç®¡ç†API

#### è·å–åº”ç”¨ä¿¡æ¯
```bash
GET /api/apps
Cookie: session_id=your-session-id

# å“åº”
{
  "client_apps": {
    "client-uuid": {
      "client_id": "client-uuid",
      "hostname": "server01",
      "apps": [
        {
          "name": "my-app",
          "version": "v1.0.0",
          "deploy_time": "2025-08-30 10:00:00",
          "branch": "main",
          "commit": "abc123",
          "service_status": "Running"
        }
      ]
    }
  }
}
```

#### ç®¡ç†åº”ç”¨æœåŠ¡
```bash
POST /api/manage-service
Content-Type: application/json
Cookie: session_id=your-session-id

{
  "client_id": "client-uuid",
  "app_name": "my-app",
  "action": "Start"  // Start, Stop, Restart, Status
}
```

#### æ›´æ–°åº”ç”¨
```bash
POST /api/update-app
Content-Type: application/json
Cookie: session_id=your-session-id

{
  "client_id": "client-uuid",
  "app_name": "my-app",
  "version": "v1.1.0"
}
```

---

## å®‰å…¨ç‰¹æ€§

### Webè®¤è¯å®‰å…¨

1. **ä¼šè¯ç®¡ç†**
   - HTTP-only Cookieé˜²æ­¢XSSæ”»å‡»
   - Secureæ ‡å¿—ç¡®ä¿HTTPSä¼ è¾“
   - SameSite=Stricté˜²æ­¢CSRFæ”»å‡»
   - 1å°æ—¶ä¼šè¯è¶…æ—¶

2. **æ´»åŠ¨ç›‘æ§**
   - ç”¨æˆ·æ´»åŠ¨è‡ªåŠ¨å»¶é•¿ä¼šè¯
   - 5åˆ†é’Ÿæ— æ´»åŠ¨è¶…æ—¶è­¦å‘Š
   - è‡ªåŠ¨ç™»å‡ºæœºåˆ¶

### å‘½ä»¤æ‰§è¡Œå®‰å…¨

1. **ç™½åå•éªŒè¯**
```rust
// é»˜è®¤å…è®¸çš„å®‰å…¨å‘½ä»¤
["ps", "ls", "pwd", "whoami", "date", "uptime", "df", "free", "top", "htop"]
```

2. **å±é™©æ¨¡å¼æ£€æµ‹**
```rust
// è‡ªåŠ¨é˜»æ­¢çš„å±é™©æ¨¡å¼
["rm -rf", "shutdown", "reboot", "mkfs", "fdisk", "dd", "curl", "wget", "nc"]
```

3. **è¾“å…¥éªŒè¯**
   - å‘½ä»¤é•¿åº¦é™åˆ¶
   - ç‰¹æ®Šå­—ç¬¦è¿‡æ»¤
   - æ³¨å…¥æ”»å‡»é˜²æŠ¤

### ç½‘ç»œé€šä¿¡å®‰å…¨

1. **TCPè®¤è¯**
   - HMAC-SHA256åŠ å¯†éªŒè¯
   - é˜²é‡æ”¾æ”»å‡»ä¿æŠ¤
   - æ—¶é—´æˆ³éªŒè¯

2. **è¿æ¥ç®¡ç†**
   - è®¤è¯å¤±è´¥ç«‹å³æ–­å¼€
   - è¿æ¥è¶…æ—¶è‡ªåŠ¨æ¸…ç†
   - æœ€å¤§è¿æ¥æ•°é™åˆ¶

### è„šæœ¬æ‰§è¡Œå®‰å…¨

1. **ç›®å½•é™åˆ¶**
   - åªå…è®¸æŒ‡å®šç›®å½•çš„è„šæœ¬
   - ç™½åå•æ‰©å±•åéªŒè¯
   - è·¯å¾„ç©¿è¶Šé˜²æŠ¤

2. **æ‰§è¡Œæƒé™**
   - è„šæœ¬æ–‡ä»¶æƒé™æ£€æŸ¥
   - ç”¨æˆ·æƒé™é™åˆ¶
   - è¶…æ—¶ä¿æŠ¤æœºåˆ¶

---

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

#### 1. å®¢æˆ·ç«¯æ— æ³•è¿æ¥æœåŠ¡å™¨

**ç—‡çŠ¶**ï¼šå®¢æˆ·ç«¯æ—¥å¿—æ˜¾ç¤ºè¿æ¥å¤±è´¥
```
[ERROR] Failed to create TCP session: Connection refused
```

**è§£å†³æ­¥éª¤**ï¼š
```bash
# 1. æ£€æŸ¥ç½‘ç»œè¿é€šæ€§
telnet server_ip 12345

# 2. æ£€æŸ¥æœåŠ¡å™¨ç«¯å£ç›‘å¬
netstat -tlnp | grep :12345

# 3. æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
sudo ufw status
sudo iptables -L

# 4. éªŒè¯æœåŠ¡å™¨é…ç½®
echo $OPS_TCP_PORT
echo $OPS_TCP_BIND_ADDR
```

#### 2. Webè®¤è¯å¤±è´¥

**ç—‡çŠ¶**ï¼šç™»å½•åç«‹å³è¢«è¦æ±‚é‡æ–°ç™»å½•

**è§£å†³æ­¥éª¤**ï¼š
```bash
# 1. æ£€æŸ¥ä¼šè¯å­˜å‚¨
# æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—ä¸­çš„ä¼šè¯ç›¸å…³ä¿¡æ¯

# 2. æ¸…é™¤æµè§ˆå™¨Cookie
# å¼€å‘è€…å·¥å…· -> Application -> Cookies -> åˆ é™¤session_id

# 3. æ£€æŸ¥ç³»ç»Ÿæ—¶é—´
date  # ç¡®ä¿å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨æ—¶é—´åŒæ­¥

# 4. é‡å¯æœåŠ¡å™¨
cargo run --bin ops-server
```

#### 3. TCPè®¤è¯å¤±è´¥

**ç—‡çŠ¶**ï¼šå®¢æˆ·ç«¯è¿æ¥æ—¶è®¤è¯å¤±è´¥
```
[WARN] Authentication failed for client xxx
[ERROR] Client connection error: Authentication failed
```

**è§£å†³æ­¥éª¤**ï¼š
```bash
# 1. ç¡®è®¤å¯†é’¥ä¸€è‡´
echo $OPS_TCP_AUTH_SECRET  # æœåŠ¡å™¨ç«¯
echo $OPS_TCP_AUTH_SECRET  # å®¢æˆ·ç«¯

# 2. æ£€æŸ¥è®¤è¯é…ç½®
echo $OPS_TCP_AUTH_ENABLED

# 3. éªŒè¯æ—¶é—´åŒæ­¥
date  # æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯æ—¶é—´å·®ä¸èƒ½è¶…è¿‡30ç§’

# 4. æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
RUST_LOG=debug cargo run --bin ops-server
RUST_LOG=debug cargo run --bin ops-client
```

#### 4. å‘½ä»¤è¢«é˜»æ­¢æ‰§è¡Œ

**ç—‡çŠ¶**ï¼šå‘½ä»¤æ‰§è¡Œæ—¶è¢«å®‰å…¨éªŒè¯æ‹’ç»

**è§£å†³æ­¥éª¤**ï¼š
```bash
# 1. æ£€æŸ¥å‘½ä»¤æ˜¯å¦åœ¨ç™½åå•ä¸­
# æŸ¥çœ‹ ops-common/src/security.rs ä¸­çš„ç™½åå•

# 2. é¿å…å±é™©æ¨¡å¼
# ä¸è¦ä½¿ç”¨åŒ…å« "rm -rf", "shutdown" ç­‰çš„å‘½ä»¤

# 3. ä½¿ç”¨é¢„å®šä¹‰å‘½ä»¤
# åœ¨Webç•Œé¢é€‰æ‹©é¢„å®šä¹‰çš„å®‰å…¨å‘½ä»¤

# 4. è‡ªå®šä¹‰ç™½åå•ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
# ä¿®æ”¹ security.rs ä¸­çš„å‘½ä»¤ç™½åå•
```

#### 5. åº”ç”¨ä¿¡æ¯æ”¶é›†å¤±è´¥

**ç—‡çŠ¶**ï¼šWebç•Œé¢æ˜¾ç¤º"æš‚æ— å®¢æˆ·ç«¯åº”ç”¨ä¿¡æ¯"

**è§£å†³æ­¥éª¤**ï¼š
```bash
# 1. æ£€æŸ¥åº”ç”¨ç›®å½•é…ç½®
echo $OPS_APPS_BASE_DIR
ls -la $OPS_APPS_BASE_DIR

# 2. åˆ›å»ºæµ‹è¯•åº”ç”¨ç›®å½•
mkdir -p /tmp/apps/test-app
echo "v1.0.0" > /tmp/apps/test-app/VERSION
echo "main" > /tmp/apps/test-app/BRANCH

# 3. é‡å¯å®¢æˆ·ç«¯
cargo run --bin ops-client

# 4. æ£€æŸ¥åº”ç”¨æ‰«ææ—¥å¿—
# æŸ¥çœ‹å®¢æˆ·ç«¯æ—¥å¿—ä¸­çš„åº”ç”¨æ‰«æä¿¡æ¯
```

### æ€§èƒ½é—®é¢˜è¯Šæ–­

#### 1. å†…å­˜ä½¿ç”¨è¿‡é«˜

```bash
# ç›‘æ§å†…å­˜ä½¿ç”¨
htop
ps aux | grep ops-server

# æ£€æŸ¥è¿æ¥æ•°
netstat -an | grep :12345 | wc -l

# è°ƒæ•´é…ç½®
export OPS_MAX_CONNECTIONS=500
export OPS_CLEANUP_INTERVAL=30
```

#### 2. å“åº”é€Ÿåº¦æ…¢

```bash
# æ£€æŸ¥ç½‘ç»œå»¶è¿Ÿ
ping server_ip

# å‡å°‘å¿ƒè·³é¢‘ç‡
export OPS_HEARTBEAT_INTERVAL=10

# ä¼˜åŒ–æ¸…ç†é—´éš”
export OPS_CLIENT_TIMEOUT=120
```

### æ—¥å¿—åˆ†æ

#### æœåŠ¡å™¨ç«¯æ—¥å¿—
```bash
# åº”ç”¨æ—¥å¿—
tail -f ops-server.log.2025-08-30

# Webè®¿é—®æ—¥å¿—
tail -f web.log.2025-08-30

# å®æ—¶æ—¥å¿—ï¼ˆå¼€å‘æ¨¡å¼ï¼‰
RUST_LOG=debug cargo run --bin ops-server
```

#### å®¢æˆ·ç«¯æ—¥å¿—
```bash
# å®¢æˆ·ç«¯æ—¥å¿—
tail -f ops-client.log.2025-08-30

# å‘½ä»¤æ‰§è¡Œæ—¥å¿—
tail -f /tmp/client_commands.log

# å®æ—¶æ—¥å¿—ï¼ˆå¼€å‘æ¨¡å¼ï¼‰
RUST_LOG=debug cargo run --bin ops-client
```

---

## æœ€ä½³å®è·µ

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

#### 1. å®‰å…¨é…ç½®
```bash
# ä½¿ç”¨å¼ºå¯†ç 
export OPS_TCP_AUTH_SECRET=$(openssl rand -hex 32)
export OPS_AUTH_TOKEN=$(openssl rand -hex 24)

# é™åˆ¶ç½‘ç»œè®¿é—®
# ä½¿ç”¨é˜²ç«å¢™åªå…è®¸å¿…è¦çš„IPè®¿é—®
sudo ufw allow from 192.168.1.0/24 to any port 12345

# å¯ç”¨HTTPSï¼ˆä½¿ç”¨åå‘ä»£ç†ï¼‰
# nginxé…ç½®SSLè¯ä¹¦ä»£ç†åˆ°3000ç«¯å£
```

#### 2. ç›‘æ§é…ç½®
```bash
# å¥åº·æ£€æŸ¥
curl http://localhost:3000/health

# ç›‘æ§æŒ‡æ ‡æ”¶é›†
# - åœ¨çº¿å®¢æˆ·ç«¯æ•°é‡
# - å‘½ä»¤æ‰§è¡ŒæˆåŠŸç‡
# - ç½‘ç»œè¿æ¥çŠ¶æ€
# - ç³»ç»Ÿèµ„æºä½¿ç”¨

# æ—¥å¿—è½®è½¬
# é…ç½®logrotateç®¡ç†æ—¥å¿—æ–‡ä»¶
```

#### 3. å¤‡ä»½ç­–ç•¥
```bash
# å®šæœŸå¤‡ä»½é…ç½®æ–‡ä»¶
cp config.toml config.toml.backup.$(date +%Y%m%d)

# å¤‡ä»½å®¢æˆ·ç«¯IDæ–‡ä»¶
cp /tmp/client_id.txt /backup/client_id.txt

# å¤‡ä»½é‡è¦æ—¥å¿—
tar -czf logs_backup_$(date +%Y%m%d).tar.gz *.log*
```

### å®¢æˆ·ç«¯ç®¡ç†

#### 1. æ‰¹é‡éƒ¨ç½²
```bash
#!/bin/bash
# deploy_client.sh
# æ‰¹é‡éƒ¨ç½²å®¢æˆ·ç«¯è„šæœ¬

SERVERS="server1 server2 server3"
SERVER_HOST="ops.example.com"
SECRET="your-shared-secret"

for server in $SERVERS; do
    echo "Deploying to $server..."
    ssh $server "
        export OPS_SERVER_HOST=$SERVER_HOST
        export OPS_TCP_AUTH_ENABLED=true
        export OPS_TCP_AUTH_SECRET=$SECRET
        /opt/ops/ops-client &
    "
done
```

#### 2. åº”ç”¨ç›®å½•æ ‡å‡†åŒ–
```bash
# æ ‡å‡†åº”ç”¨ç›®å½•ç»“æ„
/tmp/apps/
â”œâ”€â”€ app1/
â”‚   â”œâ”€â”€ VERSION      # ç‰ˆæœ¬å·æ–‡ä»¶
â”‚   â”œâ”€â”€ BRANCH       # Gitåˆ†æ”¯æ–‡ä»¶
â”‚   â”œâ”€â”€ COMMIT       # Gitæäº¤å“ˆå¸Œ
â”‚   â”œâ”€â”€ app1.sh      # å¯åŠ¨è„šæœ¬
â”‚   â””â”€â”€ app1.pid     # PIDæ–‡ä»¶
â”œâ”€â”€ app2/
â”‚   â”œâ”€â”€ VERSION
â”‚   â”œâ”€â”€ BRANCH
â”‚   â”œâ”€â”€ app2.sh
â”‚   â””â”€â”€ app2.pid
```

#### 3. æœåŠ¡è„šæœ¬æ¨¡æ¿
```bash
#!/bin/bash
# app.sh - åº”ç”¨ç®¡ç†è„šæœ¬æ¨¡æ¿

APP_NAME="myapp"
PID_FILE="/tmp/apps/$APP_NAME/$APP_NAME.pid"
LOG_FILE="/tmp/apps/$APP_NAME/$APP_NAME.log"

case "$1" in
    start)
        if [ -f $PID_FILE ] && ps -p $(cat $PID_FILE) > /dev/null; then
            echo "Service is already running"
            exit 1
        fi
        echo "Starting $APP_NAME..."
        nohup /opt/$APP_NAME/bin/$APP_NAME > $LOG_FILE 2>&1 &
        echo $! > $PID_FILE
        echo "Service started with PID $(cat $PID_FILE)"
        ;;
    stop)
        if [ -f $PID_FILE ]; then
            PID=$(cat $PID_FILE)
            kill $PID
            rm -f $PID_FILE
            echo "Service stopped"
        else
            echo "Service is not running"
        fi
        ;;
    update)
        VERSION=$2
        if [ -z "$VERSION" ]; then
            echo "Usage: $0 update <version>"
            exit 1
        fi
        echo "Updating to version $VERSION..."
        # å®ç°æ›´æ–°é€»è¾‘
        echo $VERSION > VERSION
        echo "Update completed"
        ;;
    *)
        echo "Usage: $0 {start|stop|update <version>}"
        exit 1
        ;;
esac
```

### ç³»ç»Ÿç»´æŠ¤

#### 1. å®šæœŸç»´æŠ¤ä»»åŠ¡
```bash
#!/bin/bash
# maintenance.sh - ç³»ç»Ÿç»´æŠ¤è„šæœ¬

# æ¸…ç†è¿‡æœŸæ—¥å¿—
find . -name "*.log.*" -mtime +30 -delete

# é‡å¯é•¿æ—¶é—´è¿è¡Œçš„å®¢æˆ·ç«¯
for pid in $(ps aux | grep ops-client | grep -v grep | awk '{print $2}'); do
    start_time=$(ps -p $pid -o lstart= | xargs -I {} date -d "{}" +%s)
    current_time=$(date +%s)
    runtime=$((current_time - start_time))
    
    # è¿è¡Œè¶…è¿‡7å¤©çš„å®¢æˆ·ç«¯é‡å¯
    if [ $runtime -gt 604800 ]; then
        echo "Restarting long-running client (PID: $pid)"
        kill $pid
        sleep 5
        /opt/ops/ops-client &
    fi
done
```

#### 2. ç›‘æ§è„šæœ¬
```bash
#!/bin/bash
# monitor.sh - ç³»ç»Ÿç›‘æ§è„šæœ¬

# æ£€æŸ¥æœåŠ¡å™¨å¥åº·çŠ¶æ€
health_check() {
    response=$(curl -s http://localhost:3000/health)
    if echo "$response" | grep -q '"status":"healthy"'; then
        echo "Server health: OK"
    else
        echo "Server health: FAILED"
        # å‘é€å‘Šè­¦
        echo "OPS Server health check failed" | mail -s "OPS Alert" admin@example.com
    fi
}

# æ£€æŸ¥å®¢æˆ·ç«¯è¿æ¥æ•°
client_check() {
    client_count=$(curl -s http://localhost:3000/api/clients | jq '.clients | length')
    echo "Connected clients: $client_count"
    
    if [ "$client_count" -lt 5 ]; then
        echo "Warning: Low client count"
        # å‘é€è­¦å‘Š
    fi
}

health_check
client_check
```

### å®‰å…¨åŠ å›º

#### 1. ç½‘ç»œå®‰å…¨
```bash
# é˜²ç«å¢™é…ç½®
sudo ufw default deny incoming
sudo ufw default allow outgoing
sudo ufw allow from 192.168.0.0/16 to any port 12345
sudo ufw allow from 10.0.0.0/8 to any port 3000
sudo ufw enable

# ä½¿ç”¨nginxåå‘ä»£ç†æ·»åŠ HTTPS
# /etc/nginx/sites-available/ops-system
server {
    listen 443 ssl;
    server_name ops.example.com;
    
    ssl_certificate /path/to/cert.pem;
    ssl_certificate_key /path/to/key.pem;
    
    location / {
        proxy_pass http://127.0.0.1:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

#### 2. ç³»ç»Ÿæƒé™
```bash
# åˆ›å»ºä¸“ç”¨ç”¨æˆ·
sudo useradd -r -s /bin/false ops
sudo mkdir -p /opt/ops
sudo chown ops:ops /opt/ops

# é™åˆ¶æ–‡ä»¶æƒé™
chmod 700 /opt/ops
chmod 600 config.toml

# ä½¿ç”¨systemdç®¡ç†æœåŠ¡
# /etc/systemd/system/ops-server.service
[Unit]
Description=OPS Server
After=network.target

[Service]
Type=simple
User=ops
Group=ops
WorkingDirectory=/opt/ops
ExecStart=/opt/ops/ops-server
Restart=always

[Install]
WantedBy=multi-user.target
```

---

## ç³»ç»Ÿç‰ˆæœ¬ä¿¡æ¯

- **å½“å‰ç‰ˆæœ¬**ï¼šv1.0.0
- **Rustç‰ˆæœ¬è¦æ±‚**ï¼š1.70+
- **æ”¯æŒå¹³å°**ï¼šLinux, macOS, Windows
- **æœ€åæ›´æ–°**ï¼š2025-08-30

---

## æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜æˆ–éœ€è¦æŠ€æœ¯æ”¯æŒï¼Œè¯·ï¼š

1. æŸ¥é˜…æœ¬æ–‡æ¡£çš„æ•…éšœæ’é™¤ç« èŠ‚
2. æ£€æŸ¥é¡¹ç›®Issuesï¼šhttps://github.com/your-repo/issues
3. æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯
4. è”ç³»æŠ€æœ¯æ”¯æŒå›¢é˜Ÿ

---

**æ³¨æ„**ï¼šæœ¬ç³»ç»Ÿä»…ä¾›å†…éƒ¨ä½¿ç”¨ï¼Œè¯·å‹¿åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨é»˜è®¤å¯†ç ï¼Œç¡®ä¿åŠæ—¶æ›´æ–°ç³»ç»Ÿå¹¶åº”ç”¨å®‰å…¨è¡¥ä¸ã€‚